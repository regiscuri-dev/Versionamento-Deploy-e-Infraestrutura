import { getCatalog } from './storage.js'; const Home=()=>` <section class="card"> <h1>SPA • Templates • Validação • Acessibilidade</h1> <p>Projeto final com <strong>GitFlow</strong>, <strong>WCAG 2.1 AA</strong> e <strong>Deploy</strong> automatizado.</p> <ul> <li>Navegação por teclado e foco visível</li> <li>Alto contraste e modo escuro acessível</li> <li>Persistência de estado no <code>localStorage</code></li> </ul> </section>`; const Catalogo=()=>{const itens=getCatalog(); return ` <section class="card"> <h1>Catálogo (Fake API)</h1> <div class="grid cols-3" id="catalogGrid" role="list"> ${itens.map(i=>` <article class="card" role="listitem"> <h3>${i.nome}</h3> <p>${i.desc}</p> <p><strong>R$ ${i.preco.toFixed(2)}</strong></p> <button class="btn" data-add="${i.id}">Adicionar</button> </article> `).join('')} </div> </section> <section class="card"> <h2>Carrinho</h2> <div id="cart"></div> </section>`;}; const Formulario=()=>{ setTimeout(()=>document.dispatchEvent(new CustomEvent('route:form')),0); return ` <section class="card"> <h1>Formulário Acessível com Verificação de Consistência</h1> <form id="signupForm" novalidate> <div class="row"> <div class="field"> <label for="nome">Nome completo</label> <input id="nome" name="nome" autocomplete="name" required minlength="3" /> <div class="help" id="h-nome">Mínimo 3 caracteres.</div> </div> <div class="field"> <label for="email">E-mail</label> <input id="email" name="email" type="email" autocomplete="email" required aria-describedby="h-email" /> <div class="help" id="h-email">Informe um e-mail válido.</div> </div> </div> <div class="row"> <div class="field"> <label for="senha">Senha</label> <input id="senha" name="senha" type="password" minlength="6" required /> </div> <div class="field"> <label for="confirmSenha">Confirmar senha</label> <input id="confirmSenha" name="confirmSenha" type="password" minlength="6" required /> </div> </div> <div class="row"> <div class="field"> <label for="nascimento">Data de nascimento</label> <input id="nascimento" name="nascimento" type="date" required /> </div> <div class="field"> <label for="telefone">Telefone</label> <input id="telefone" name="telefone" type="tel" inputmode="numeric" pattern="\d{10,11}" placeholder="Apenas números" required /> <div class="help">Use 10–11 dígitos (DDD + número).</div> </div> </div> <div class="row"> <div class="field"> <label for="inicio">Período – Início</label> <input id="inicio" name="inicio" type="date" required /> </div> <div class="field"> <label for="fim">Período – Fim</label> <input id="fim" name="fim" type="date" required /> </div> </div> <div class="field"> <label for="plano">Plano</label> <select id="plano" name="plano" required> <option value="">Selecione…</option> <option>Start</option> <option>Pro</option> <option>Enterprise</option> </select> </div> <div class="field"> <label><input id="termos" name="termos" type="checkbox" required /> Li e aceito os termos de uso.</label> </div> <div aria-live="polite" class="error" id="formErrors"></div> <button class="btn" type="submit">Enviar</button> <button class="btn ghost" type="button" id="salvarRascunho">Salvar rascunho</button> <span class="success" id="okMsg" role="status" aria-live="polite"></span> </form> </section>`;}; const NotFound=()=>`<section class="card"><h1>404</h1><p>Página não encontrada. Use o menu acima.</p></section>`; export const routes={'#/home':{template:Home},'#/catalogo':{template:Catalogo,afterRender:()=>import('./storage.js').then(m=>m.mountCartHandlers())},'#/formulario':{template:Formulario},'#/404':{template:NotFound}}; const CATALOG_KEY='app.catalog';const CART_KEY='app.cart'; export function getCatalog(){const exists=localStorage.getItem(CATALOG_KEY);if(exists){return JSON.parse(exists);}const seed=[{id:'p1',nome:'Teclado Mecânico',desc:'Switches táteis, RGB',preco:299.9},{id:'p2',nome:'Mouse Ergonômico',desc:'Alta precisão, 6 botões',preco:179.5},{id:'p3',nome:'Headset',desc:'Som estéreo, microfone',preco:239.0},{id:'p4',nome:'Suporte Notebook',desc:'Ajustável, alumínio',preco:119.9},{id:'p5',nome:'Webcam HD',desc:'1080p, auto foco',preco:199.0},{id:'p6',nome:'Hub USB-C',desc:'7 portas, PD',preco:149.9},];localStorage.setItem(CATALOG_KEY,JSON.stringify(seed));return seed;} function getCart(){return JSON.parse(localStorage.getItem(CART_KEY)||'[]');} function setCart(cart){localStorage.setItem(CART_KEY,JSON.stringify(cart));renderCart();} export function setupCatalog(){getCatalog();} export function mountCartHandlers(){const grid=document.getElementById('catalogGrid');grid?.addEventListener('click',e=>{const btn=e.target.closest('button[data-add]');if(!btn)return;const id=btn.getAttribute('data-add');const item=getCatalog().find(i=>i.id===id);const cart=getCart();const found=cart.find(i=>i.id===id);if(found){found.qtd+=1;}else{cart.push({id,nome:item.nome,preco:item.preco,qtd:1});}setCart(cart);});renderCart();} function renderCart(){const el=document.getElementById('cart');if(!el)return;const cart=getCart();if(cart.length===0){el.innerHTML='<p class="help">Seu carrinho está vazio.</p>';return;}const total=cart.reduce((s,i)=>s+i.preco*i.qtd,0);el.innerHTML=` <table> <thead><tr><th>Item</th><th>Qtd</th><th>Preço</th><th>Total</th><th></th></tr></thead> <tbody> ${cart.map(i=>` <tr> <td>${i.nome}</td> <td><input type="number" min="1" value="${i.qtd}" data-qtd="${i.id}" /></td> <td>R$ ${i.preco.toFixed(2)}</td> <td>R$ ${(i.preco*i.qtd).toFixed(2)}</td> <td><button class="btn small" data-rem="${i.id}">Remover</button></td> </tr>`).join('')} </tbody> <tfoot><tr><td colspan="3"><strong>Total</strong></td><td colspan="2"><strong>R$ ${total.toFixed(2)}</strong></td></tr></tfoot> </table>`;el.addEventListener('input',e=>{const input=e.target.closest('input[data-qtd]');if(!input)return;const id=input.getAttribute('data-qtd');const item=getCart().find(i=>i.id===id);item.qtd=Math.max(1,parseInt(input.value||'1',10));setCart(getCart().map(x=>x.id===id?item:x));});el.addEventListener('click',e=>{const btn=e.target.closest('button[data-rem]');if(!btn)return;const id=btn.getAttribute('data-rem');setCart(getCart().filter(i=>i.id!==id));});} const DRAFT_KEY='app.formDraft'; export function saveDraft(data){ localStorage.setItem(DRAFT_KEY, JSON.stringify(data)); } export function loadDraft(){ try{ return JSON.parse(localStorage.getItem(DRAFT_KEY)||'null'); }catch{return null;} } export function clearDraft(){ localStorage.removeItem(DRAFT_KEY); } import { saveDraft, loadDraft, clearDraft } from './validation_draft.js'; const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i; export function initFormValidation(){ const form=document.getElementById('signupForm'); if(!form) return; const errorsEl=document.getElementById('formErrors'); const okMsg=document.getElementById('okMsg'); const draftBtn=document.getElementById('salvarRascunho'); const draft=loadDraft(); if(draft){ Object.entries(draft).forEach(([k,v])=>{const el=form.elements.namedItem(k); if(el) el.value=v;});} function showErrors(msgs){ errorsEl.innerHTML=msgs.map(m=>`<div>• ${m}</div>`).join(''); } function validate(){ const msgs=[]; const data=Object.fromEntries(new FormData(form).entries()); if(!data.nome||data.nome.trim().length<3) msgs.push('Nome deve ter ao menos 3 caracteres.'); if(!emailRegex.test(data.email||'')) msgs.push('E-mail inválido.'); if(!data.senha||data.senha.length<6) msgs.push('Senha deve ter 6+ caracteres.'); if(data.senha!==data.confirmSenha) msgs.push('Senha e confirmação não conferem.'); if(!/^[0-9]{10,11}$/.test(data.telefone||'')) msgs.push('Telefone deve ter 10–11 dígitos (apenas números).'); const hoje=new Date(); const nasc=data.nascimento? new Date(data.nascimento): null; if(!nasc||isNaN(nasc)) msgs.push('Data de nascimento é obrigatória.'); if(nasc&&(hoje.getFullYear()-nasc.getFullYear()<18||(hoje.getFullYear()-nasc.getFullYear()===18&&(new Date(hoje.getFullYear(),nasc.getMonth(),nasc.getDate())>hoje)))) msgs.push('Você deve ter 18 anos ou mais.'); const inicio=data.inicio? new Date(data.inicio): null; const fim=data.fim? new Date(data.fim): null; if(inicio&&fim&&inicio>fim) msgs.push('Período inválido: data inicial não pode ser maior que a final.'); if(!data.plano) msgs.push('Selecione um plano.'); if(!form.termos.checked) msgs.push('Você deve aceitar os termos de uso.'); return { ok: msgs.length===0, msgs, data }; } form.addEventListener('submit', e=>{ e.preventDefault(); const {ok,msgs,data}=validate(); if(!ok){showErrors(msgs); okMsg.textContent=''; return;} clearDraft(); showErrors([]); okMsg.textContent='Formulário enviado com sucesso!'; console.log('Dados prontos para envio:', data); form.reset(); }); draftBtn?.addEventListener('click', ()=>{ const {data}=validate(); saveDraft(data); okMsg.textContent='Rascunho salvo (local).'; }); form.addEventListener('input', ()=>{ const {ok,msgs}=validate(); if(ok){showErrors([]);} else {showErrors(msgs);} }); } const THEME_KEY='app.theme'; const CONTRAST_KEY='app.contrast'; export function initTheme(){ const btn=document.getElementById('themeToggle'); const current=localStorage.getItem(THEME_KEY)||(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'); setTheme(current); btn?.addEventListener('click',()=>{ const next=document.documentElement.dataset.theme==='dark'?'light':'dark'; setTheme(next); btn.setAttribute('aria-pressed', String(next==='dark')); }); } export function initHighContrast(){ const btn=document.getElementById('contrastToggle'); const current=localStorage.getItem(CONTRAST_KEY)||'off'; setContrast(current==='on'); btn?.addEventListener('click',()=>{ const active=document.documentElement.dataset.contrast==='high'?false:true; setContrast(active); btn.setAttribute('aria-pressed', String(active)); }); } function setTheme(mode){ document.documentElement.dataset.theme=mode; if(mode==='light'){ document.documentElement.style.setProperty('--bg','#f7f7fb'); document.documentElement.style.setProperty('--text','#1e1e25'); document.documentElement.style.setProperty('--muted','#5b5b66'); document.documentElement.style.setProperty('--card','#ffffff'); } else { document.documentElement.style.removeProperty('--bg'); document.documentElement.style.removeProperty('--text'); document.documentElement.style.removeProperty('--muted'); document.documentElement.style.removeProperty('--card'); } localStorage.setItem(THEME_KEY, mode); } function setContrast(on){ if(on){ document.documentElement.dataset.contrast='high'; localStorage.setItem(CONTRAST_KEY,'on'); } else { document.documentElement.dataset.contrast=''; localStorage.setItem(CONTRAST_KEY,'off'); } } import { routes } from './templates.js'; import { initFormValidation } from './validation.js'; import { setupCatalog } from './storage.js'; const app=document.getElementById('app'); function render(path){const route=routes[path]??routes['#/404'];app.setAttribute('aria-busy','true');app.innerHTML=route.template();if(route.afterRender){route.afterRender();}app.setAttribute('aria-busy','false');app.focus();} function onRouteChange(){const path=location.hash||'#/home';render(path);} export function startRouter(){window.addEventListener('hashchange',onRouteChange);window.addEventListener('DOMContentLoaded',onRouteChange);onRouteChange();setupCatalog();document.addEventListener('route:form',initFormValidation,{once:false});}